<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../simpla-element-behavior/simpla-element-behavior.html"> <dom-module id="simpla-collection"> <template> <style>:host{display:block;box-sizing:border-box}.wrapper{position:relative;min-height:100px;box-sizing:border-box}</style> <div class="wrapper"> <template is="dom-if" if="[[editable]]"> <simpla-collection-editor items="[[items]]" as="[[as]]" active="{{active}}" on-collection-item-edit="_handleEdit"> </simpla-collection-editor> </template> <slot></slot> </div> </template> <script>!function(){"use strict";function t(){return Math.random().toString(36).substr(-4)}var e=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},i="simpla-collection-editor.html";Polymer({is:"simpla-collection",properties:{items:{type:Array,value:[]},as:{type:String,value:"item"},active:{type:Boolean,notify:!0,value:!1},editable:{type:Boolean,observer:"_importEditor",notify:!0,value:!1}},observers:["_render(items.*)"],behaviors:[SimplaBehaviors.Element],created:function(){this.setupSimpla({type:"Collection",dataProperties:["items"]})},add:function(){this.push("items",{id:t()})},remove:function(t){var e=this.path+"/"+t,i=this.items.indexOf({id:t});Simpla.remove(e),this.splice("items",i,1)},swap:function(t,e){var i=this.items,r=i.slice(),o=i.indexOf({id:t}),n=i.indexOf({id:e});r[n]=i[o],r[o]=i[n],this.items=r},_handleEdit:function(t){var i=t.detail.action,r=t.detail.args;this[i].apply(this,e(r)),t.stopPropagation()},_render:function(){for(var t=this,e=Polymer.dom(this).querySelector("template"),i=this.items,r=function(e,i){var r=["path","sid","gid"];r.forEach(function(r){Array.prototype.forEach.call(e.querySelectorAll("["+r+"]"),function(e){var o=e.getAttribute(r);e.setAttribute(r,o.replace("["+t.as+"]",i))})})};this.children.length>1;)Polymer.dom(this).removeChild(this.children[1]);i.forEach(function(i,o){var n=document.importNode(e.content,!0);r(n,i.id),Polymer.dom(t).appendChild(n)})},_importEditor:function(t){t&&this.importHref(this.resolveUrl(i))}})}(); </script> </dom-module> 